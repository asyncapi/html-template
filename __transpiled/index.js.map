{"version":3,"file":"index.js","sources":["../template/index.js"],"sourcesContent":["import ReactDOMServer from \"react-dom/server\";\nimport AsyncAPIComponent from \"@asyncapi/react-component\";\nimport { File } from \"@asyncapi/generator-react-sdk\";\nimport yaml from 'js-yaml';\n\nexport default async function({ asyncapi, originalAsyncAPI }) {\n  return (\n    <File name=\"asyncapi.html\">\n      {/* <WebComponent originalAsyncAPI={originalAsyncAPI} /> */}\n      <Hydration asyncapi={asyncapi} />\n    </File>\n  );\n}\n\nfunction WebComponent({ originalAsyncAPI }) {\n  const json = parseOriginalSpec(originalAsyncAPI)\n  // double JSON.stringify - trick for escaping \\\"\n  const stringified = JSON.stringify(JSON.stringify(json));\n  \n  return `<!DOCTYPE html>\n  <html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <script src=\"js/web-component-polyfill.js\"></script>\n    <script src=\"js/web-component.js\"></script>\n    <script>\n      var schema = ${stringified}\n      window.onload = function() {\n        document.getElementById(\"asyncapi\").schema=schema;\n      };\n    </script>\n  </head>\n  <body>\n    <asyncapi-component\n      id=\"asyncapi\"\n      cssImportPath=\"css/fiori.css\">\n    </asyncapi-component>\n  </body>\n</html>`;\n}\n\nfunction parseOriginalSpec(originalAsyncAPI) {\n  try {\n    return JSON.parse(originalAsyncAPI);\n  } catch (e) {\n    return yaml.load(originalAsyncAPI);\n  }\n}\n\nfunction Hydration({ asyncapi }) {\n  const component = (\n    <AsyncAPIComponent \n      parsedSchema={asyncapi}\n    />\n  );\n  const content = ReactDOMServer.renderToString(component);\n\n  const originalAsyncAPI = asyncapi.json();\n  // double JSON.stringify - trick for escaping \\\"\n  const stringified = JSON.stringify(JSON.stringify(originalAsyncAPI));\n\n  return `<!DOCTYPE html>\n  <html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <link href=\"https://unpkg.com/@asyncapi/react-component@0.20.1/lib/styles/fiori.css\" rel=\"stylesheet\">\n  </head>\n  <body>\n    <div id=\"root\">${content}</div>\n  </body>\n  <script src=\"https://unpkg.com/@asyncapi/parser@1.4.0/dist/bundle.js\" crossorigin></script>\n  <script src=\"https://unpkg.com/react@17.0.1/umd/react.development.js\" crossorigin></script>\n  <script src=\"https://unpkg.com/react-dom@17/umd/react-dom.development.js\" crossorigin></script>\n  <script src=\"js/component.min.js\"></script>\n  <script>\n    AsyncAPIParser.parse(${stringified}).then(schema => {\n      ReactDOM.hydrate(\n        React.createElement(AsyncApiComponent, { schema }),\n        document.getElementById(\"root\")\n      );\n    });\n    // ReactDOM.hydrate(\n    //   React.createElement(AsyncApiComponent, { schema }),\n    //   document.getElementById(\"root\")\n    // );\n  </script>\n</html>`;\n}\n\n{/* <script src=\"https://unpkg.com/react@17/umd/react.development.js\" crossorigin></script>\n<script src=\"https://unpkg.com/react-dom@17/umd/react-dom.development.js\" crossorigin></script>\n<script type=\"module\" src=\"https://unpkg.com/@asyncapi/react-component@0.20.1/lib/index.js\"></script> */}\n"],"names":["asyncapi","originalAsyncAPI","_jsx","File","Hydration","component","AsyncAPIComponent","content","ReactDOMServer","renderToString","json","stringified","JSON","stringify"],"mappings":";;;;;;;;;;;;;;AAKe,sBAAe;AAAEA,EAAAA,QAAF;AAAYC,EAAAA;AAAZ,CAAf,EAA+C;AAC5D,sBACEC,eAACC,sBAAD;AAAM,IAAA,IAAI,EAAC,eAAX;AAAA,2BAEED,eAAC,SAAD;AAAW,MAAA,QAAQ,EAAEF;AAArB;AAFF,IADF;AAMD;;AAsCD,SAASI,SAAT,CAAmB;AAAEJ,EAAAA;AAAF,CAAnB,EAAiC;AAC/B,QAAMK,SAAS,gBACbH,eAACI,qCAAD;AACE,IAAA,YAAY,EAAEN;AADhB,IADF;;AAKA,QAAMO,OAAO,GAAGC,kCAAc,CAACC,cAAf,CAA8BJ,SAA9B,CAAhB;AAEA,QAAMJ,gBAAgB,GAAGD,QAAQ,CAACU,IAAT,EAAzB,CAR+B;;AAU/B,QAAMC,WAAW,GAAGC,IAAI,CAACC,SAAL,CAAeD,IAAI,CAACC,SAAL,CAAeZ,gBAAf,CAAf,CAApB;AAEA,SAAQ;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqBM,OAAQ;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2BI,WAAY;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QA1BE;AA2BD;;;;"}